<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>月間カレンダー</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link
      rel="stylesheet"
      th:href="@{/css/common.css}"
      href="/css/common.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesk:wght@500;600&family=Noto+Sans+JP:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", "Noto Sans JP", sans-serif;
        background-color: #0f172a;
        color: #e2e8f0;
      }

      .glass-panel {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      h1,
      h2 {
        font-family: "Inter", "Noto Sans JP", sans-serif;
        font-weight: 700;
      }

      .calendar-card {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1.5rem;
        transition: all 0.3s ease;
      }

      .calendar-card:hover {
        background: rgba(30, 41, 59, 0.85);
        transform: translateY(-2px) scale(1.005);
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.15);
      }

      .fixed-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
      }

      .aura {
        position: absolute;
        border-radius: 50%;
        filter: blur(100px);
      }

      .aura-1 {
        top: -10%;
        left: -10%;
        width: 40%;
        height: 40%;
        background: rgba(99, 102, 241, 0.2);
      }

      .aura-2 {
        bottom: -10%;
        right: -10%;
        width: 40%;
        height: 40%;
        background: rgba(16, 185, 129, 0.1);
      }
    </style>
  </head>
  <body class="min-h-screen py-10">
    <div class="fixed-bg">
      <div class="aura aura-1"></div>
      <div class="aura aura-2"></div>
    </div>
    <div class="max-w-6xl mx-auto px-4 space-y-8">
      <header
        class="flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between"
      >
        <div>
          <p class="text-sm text-slate-400 tracking-[0.5em] uppercase">
            Flow Calendar
          </p>
          <h1
            class="text-4xl font-extrabold text-white"
            th:text="${monthLabel}"
          ></h1>
          <p class="text-sm text-slate-400 mt-2 font-light">
            今月の毎日をカレンダーで俯瞰し、収入と支出の動きをざっと確認できます。
          </p>
        </div>
        <div class="flex flex-wrap gap-3">
          <a
            href="/"
            class="px-6 py-3 bg-emerald-500/10 border border-emerald-500/50 text-emerald-400 rounded-2xl hover:bg-emerald-500 hover:text-white transition-all duration-300 font-bold"
            >ホーム</a
          >
        </div>
      </header>

      <section class="grid gap-4 md:grid-cols-3">
        <article class="glass-panel p-6 rounded-3xl">
          <p class="text-xs uppercase tracking-widest text-slate-400">Income</p>
          <h2 class="text-3xl text-emerald-400 font-bold mt-2">
            <span
              th:text="${#numbers.formatDecimal(monthIncomeTotal, 1, 'COMMA', 0, 'POINT')}"
            ></span>
          </h2>
          <p class="text-xs text-slate-500 mt-1">今月の合計収入</p>
        </article>
        <article class="glass-panel p-6 rounded-3xl">
          <p class="text-xs uppercase tracking-widest text-slate-400">
            Expense
          </p>
          <h2 class="text-3xl text-rose-400 font-bold mt-2">
            <span
              th:text="${#numbers.formatDecimal(monthExpenseTotal, 1, 'COMMA', 0, 'POINT')}"
            ></span>
          </h2>
          <p class="text-xs text-slate-500 mt-1">今月の合計支出</p>
        </article>
        <article class="glass-panel p-6 rounded-3xl">
          <p class="text-xs uppercase tracking-widest text-slate-400">Net</p>
          <h2
            class="text-3xl font-bold mt-2"
            th:classappend="${monthNet >= 0} ? 'text-emerald-400' : 'text-rose-400'"
          >
            <span
              th:text="${#numbers.formatDecimal(monthNet, 1, 'COMMA', 0, 'POINT')}"
            ></span>
          </h2>
          <p class="text-xs text-slate-500 mt-1">収入 − 支出</p>
        </article>
      </section>

      <section class="space-y-4">
        <div class="grid grid-cols-7 text-center text-xs text-slate-500">
          <p
            class="uppercase tracking-[0.2em] font-bold"
            th:each="weekday : ${weekdays}"
            th:text="${weekday}"
          ></p>
        </div>

        <div class="space-y-4">
          <div class="grid grid-cols-7 gap-4" th:each="week : ${weeks}">
            <article
              class="calendar-card p-4 flex flex-col gap-3"
              th:each="day : ${week}"
              th:classappend="${(day.inCurrentMonth() ? '' : 'opacity-40 ') + (day.date().equals(today) ? ' ring-2 ring-emerald-400 shadow-xl shadow-emerald-400/20' : '')}"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p
                    class="text-xs uppercase tracking-[0.4em] text-slate-500"
                    th:text="${day.weekdayLabel()}"
                  ></p>
                  <p
                    class="text-3xl font-bold text-white"
                    th:text="${day.dayOfMonth()}"
                  ></p>
                </div>
                <div class="text-right text-xs space-y-0.5">
                  <p
                    th:each="record, stat : ${day.records()}"
                    th:with="recordCount=${#lists.size(day.records())}"
                    th:classappend="${record.recordType().name() == 'INCOME'} ? 'text-emerald-400' : 'text-rose-400'"
                    th:style="${recordCount > 4 and stat.index < (recordCount - 4)} ? |opacity: ${0.3 + (stat.index * 0.7 / (recordCount - 4))}| : ''"
                    class="font-semibold truncate"
                    th:title="${record.note()}"
                  >
                    <span
                      th:text="${record.recordType().name() == 'INCOME' ? '+' : '-'}"
                    ></span>
                    <span
                      th:text="${#numbers.formatDecimal(record.amount(), 1, 'COMMA', 0, 'POINT')}"
                    ></span>
                    <span
                      th:if="${not #strings.isEmpty(record.note())}"
                      class="text-[10px] text-slate-400 ml-1"
                      th:text="${#strings.abbreviate(record.note(), 6)}"
                    ></span>
                  </p>
                </div>
              </div>

              <div
                class="text-[11px] uppercase tracking-[0.3em] text-emerald-400 font-bold"
                th:if="${day.date().equals(today)}"
              >
                Today
              </div>
            </article>
          </div>
        </div>
      </section>
    </div>
  </body>
</html>
